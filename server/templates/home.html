{% extends "base.html" %}
{% block content %}
  <div class="rounded-3xl border border-zinc-800/80 bg-zinc-950/55 p-6 shadow-[0_0_0_1px_rgba(255,255,255,0.02),0_10px_30px_-20px_rgba(0,0,0,0.8)]">
    <div class="flex flex-wrap items-start justify-between gap-4">
      <div>
        <h1 class="text-2xl font-semibold tracking-tight">Shifts</h1>
        <p class="mt-1 text-sm text-zinc-400">
          Capture messy notes. Get a rubric-scored Decision Card + a clean handoff.
        </p>
        <div class="mt-4 flex flex-wrap items-center gap-2 text-xs text-zinc-400">
          <span class="rounded-full border border-zinc-800/80 bg-zinc-950/50 px-2.5 py-1">
            <span class="text-zinc-500">1</span> New shift
          </span>
          <span class="rounded-full border border-zinc-800/80 bg-zinc-950/50 px-2.5 py-1">
            <span class="text-zinc-500">2</span> Add notes
          </span>
          <span class="rounded-full border border-zinc-800/80 bg-zinc-950/50 px-2.5 py-1">
            <span class="text-zinc-500">3</span> Generate plan
          </span>
          <span class="rounded-full border border-zinc-800/80 bg-zinc-950/50 px-2.5 py-1">
            <span class="text-zinc-500">4</span> Export
          </span>
        </div>
        <div class="mt-3 text-xs text-zinc-500">
          Outputs: <span class="text-zinc-300">12h plan</span> Â· <span class="text-zinc-300">24h outlook</span> Â· <span class="text-zinc-300">evidence links</span> Â· <span class="text-zinc-300">Markdown export</span>
        </div>
      </div>
      <div class="flex flex-wrap gap-2">
        {% if settings and settings.demo_mode %}
          <form action="/demo/reset" method="post" onsubmit="return confirm('Reset demo data? This deletes all shifts/runs/logs and re-seeds the last 30 days.');">
            <button
              class="rounded-2xl border border-rose-500/40 bg-rose-500/10 px-4 py-2 text-sm font-semibold text-rose-200 hover:bg-rose-500/15"
              title="Deletes all shift data and reseeds a month of demo shifts"
            >
              Reset demo month
            </button>
          </form>
        {% endif %}
        <form action="/demo" method="post">
          <button
            class="rounded-2xl border border-indigo-500/40 bg-indigo-500/10 px-4 py-2 text-sm font-semibold text-indigo-200 hover:bg-indigo-500/15"
          >
            Demo shift
          </button>
        </form>
        <form action="/shifts/new" method="post">
          <button
            class="rounded-2xl bg-zinc-100 px-4 py-2 text-sm font-semibold text-zinc-950 shadow hover:bg-white"
          >
            New shift
          </button>
        </form>
      </div>
    </div>
  </div>

  <div class="mt-6 grid gap-3">
    {% if shifts|length == 0 %}
      <div class="rounded-3xl border border-zinc-800/80 bg-zinc-950/55 p-6 text-sm text-zinc-400">
        <div class="font-semibold text-zinc-200">No shifts yet.</div>
        <div class="mt-1">Create one to start capturing notes.</div>
      </div>
    {% endif %}

    {% for s in shifts %}
      <div
        class="shift-card group rounded-3xl border border-zinc-800/80 bg-zinc-950/55 p-5 shadow-[0_0_0_1px_rgba(255,255,255,0.02)] transition hover:border-zinc-700/80 hover:bg-zinc-950/70"
      >
        <div class="flex items-start justify-between gap-4">
          <a class="min-w-0 flex-1" href="/shifts/{{ s['_id'] }}">
            <div class="flex flex-wrap items-center gap-2">
              <div class="truncate text-sm font-semibold text-zinc-100">
                {{ s.title or "Untitled shift" }}
              </div>
              {% if s.last_run_status %}
                <span class="rounded-full border px-2 py-0.5 text-[11px]
                  {% if s.last_run_status == 'completed' %}border-emerald-500/40 bg-emerald-500/10 text-emerald-200
                  {% elif s.last_run_status == 'running' %}border-amber-500/40 bg-amber-500/10 text-amber-200
                  {% elif s.last_run_status == 'failed' %}border-rose-500/40 bg-rose-500/10 text-rose-200
                  {% else %}border-zinc-800/80 bg-zinc-950/40 text-zinc-400{% endif %}">
                  {{ s.last_run_status }}
                </span>
              {% endif %}
            </div>

            <div class="mt-1 flex flex-wrap items-center gap-x-2 gap-y-1 text-xs text-zinc-500">
              <span class="rounded-full border border-zinc-800/80 bg-zinc-950/40 px-2 py-0.5 text-[11px] text-zinc-400">
                {{ s.log_count or 0 }} entries
              </span>
              <span class="rounded-full border border-zinc-800/80 bg-zinc-950/40 px-2 py-0.5 text-[11px] text-zinc-400">
                {{ s.run_count or 0 }} runs
              </span>
              {% if s.created_at_iso %}
                <span class="text-zinc-600">Â·</span>
                <span>
                  Started <time data-time="local" datetime="{{ s.created_at_iso }}">{{ s.created_at }}</time>
                </span>
              {% endif %}
              {% if s.updated_at_iso %}
                <span class="text-zinc-600">Â·</span>
                <span>
                  Updated <time data-time="relative" datetime="{{ s.updated_at_iso }}">{{ s.updated_at }}</time>
                </span>
              {% endif %}
              {% if s.last_run_at_iso %}
                <span class="text-zinc-600">Â·</span>
                <span>
                  Last run <time data-time="relative" datetime="{{ s.last_run_at_iso }}">recently</time>
                </span>
              {% endif %}
              <span class="ml-1 rounded-full border border-zinc-800/60 bg-zinc-950/30 px-2 py-0.5 text-[11px] text-zinc-500 opacity-0 transition group-hover:opacity-100">
                id {{ s['_id'][:6] }}
              </span>
            </div>
          </a>

          <div class="mt-0.5 flex items-start gap-2">
            <form
              action="/shifts/{{ s['_id'] }}/delete"
              method="post"
              hx-post="/shifts/{{ s['_id'] }}/delete"
              hx-target="closest .shift-card"
              hx-swap="outerHTML"
              hx-confirm="Delete this shift and all its data?"
            >
              <button
                type="submit"
                class="inline-flex h-9 w-9 items-center justify-center rounded-2xl border border-zinc-800/80 bg-zinc-950/40 text-base text-zinc-300 transition hover:border-rose-500/40 hover:bg-rose-500/10 hover:text-rose-200"
                aria-label="Delete shift"
                title="Delete shift"
              >
                ğŸ—‘ï¸
              </button>
            </form>
            <a
              href="/shifts/{{ s['_id'] }}"
              class="inline-flex h-9 items-center rounded-2xl border border-zinc-800/80 bg-zinc-950/40 px-3 text-xs font-semibold text-zinc-300 transition hover:border-zinc-700/80 hover:text-zinc-200"
              title="Open"
            >
              Open â†’
            </a>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
{% endblock %}
